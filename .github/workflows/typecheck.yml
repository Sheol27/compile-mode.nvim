name: Typecheck

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  typecheck:
    name: Typecheck Code

    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          path: compile-mode.nvim

      - name: Setup `plenary.nvim`
        uses: actions/checkout@v4
        with:
          repository: nvim-lua/plenary.nvim
          path: /deps/plenary.nvim

      - name: Setup Neovim Runtime
        uses: actions/checkout@v4
        with:
          repository: neovim/neovim
          path: /deps/neovim

      - name: Typecheck
        uses: mrcjkb/lua-typecheck-action@v1
        env:
          VIMRUNTIME: /deps/neovim/runtime
          PLENARY_PATH: /deps/plenary.nvim
        with:
          directories: |
            compile-mode.nvim
          configpath: compile-mode.nvim/.luarc-ci.json
